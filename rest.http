# @baseUrl = https://store-track-api.vercel.app
@baseUrl = http://localhost:5000

@email = zintra@cth.com
@password = secure1234
@storeId = 8765412345678909

# Staff test credentials (must be unique per store)
@staffEmail = staffzintra@cth.com
@staffPassword = secure1234


### Register (may return 400 if user exists)
POST {{baseUrl}}/api/auth/register-send-otp
Content-Type: application/json

{
  "name": "Zintra",
  "email": "{{email}}",
  "password": "{{password}}",
  "store": "{{storeId}}"
}


### Verify email (OTP)
# After registration, check your inbox for the 6-digit code.
# @name verifyEmail
POST {{baseUrl}}/api/auth/verify-otp-login
Content-Type: application/json

{
  "email": "{{email}}",
  "code": "123456"
}


### Login
# @name login
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "{{password}}"
}


### Me (sanity)
GET {{baseUrl}}/api/auth/me
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Update profile (URL/data URI)
PATCH {{baseUrl}}/api/auth/me
Authorization: Bearer {{login.response.body.tokens.accessToken}}
Content-Type: application/json

{
  "profileImage": "https://example.com/pic.jpg"
}


### Forgot password
# In production this emails a reset link and does NOT return a token.
# Dev/testing: set RETURN_RESET_TOKEN=true (and NODE_ENV != production) to also get resetToken/resetUrl in the response.
# @name forgotPassword
POST {{baseUrl}}/api/auth/forgot-password
Content-Type: application/json

{
  "email": "{{email}}"
}


### Reset password
# Token comes from the email link (frontend route) in production.
# For local testing with RETURN_RESET_TOKEN=true, you can use forgotPassword.response.body.resetToken.
POST {{baseUrl}}/api/auth/reset-password/{{forgotPassword.response.body.resetToken}}
Content-Type: application/json

{
  "password": "secure1234"
}


### Refresh token
POST {{baseUrl}}/api/auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{login.response.body.tokens.refreshToken}}"
}


### Create product
# @name createProduct
POST {{baseUrl}}/api/products
Authorization: Bearer {{login.response.body.tokens.accessToken}}
Content-Type: application/json

{
  "name": "Battery",
  "price": 600,
  "costPrice": 200,
  "quantity": 10,
  "lowStockThreshold": 5,
  "description": "Battery for electronic devices"
}


### List products
GET {{baseUrl}}/api/products
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Update product
PUT {{baseUrl}}/api/products/{{createProduct.response.body._id}}
Authorization: Bearer {{login.response.body.tokens.accessToken}}
Content-Type: application/json

{
  "price": 550,
  "quantity": 15,
  "description": "Updated description"
}


### Product search (name/SKU/barcode)
GET {{baseUrl}}/api/products/search?q=ground&limit=20
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Product lookup by SKU
GET {{baseUrl}}/api/products/lookup?sku=SKU-001
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Product lookup by barcode
GET {{baseUrl}}/api/products/lookup?barcode=1234567890123
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Create staff
# @name createStaff
POST {{baseUrl}}/api/staff
Authorization: Bearer {{login.response.body.tokens.accessToken}}
Content-Type: application/json

{
  "name": "Bose",
  "email": "{{staffEmail}}",
  "password": "{{staffPassword}}",
  "role": "staff"
}


### Staff login
# @name staffLogin
POST {{baseUrl}}/api/staff-auth/login
Content-Type: application/json

{
  "email": "{{staffEmail}}",
  "password": "{{staffPassword}}"
}


### Staff refresh (body-based)
POST {{baseUrl}}/api/staff-auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{staffLogin.response.body.tokens.refreshToken}}"
}


### Staff logout (body-based)
POST {{baseUrl}}/api/staff-auth/logout
Content-Type: application/json

{
  "refreshToken": "{{staffLogin.response.body.tokens.refreshToken}}"
}


### Cloudinary signed params (direct-to-cloud helper)
# @name cloudinarySignature
POST {{baseUrl}}/api/uploads/cloudinary-signature
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Persist profile image after direct Cloudinary upload
# 1) Upload image directly to Cloudinary using the signature response.
# 2) Take Cloudinary's `public_id` and paste it below.
PUT {{baseUrl}}/api/auth/me/profile-image
Authorization: Bearer {{login.response.body.tokens.accessToken}}
Content-Type: application/json

{
  "profileImagePublicId": "{{cloudinarySignature.response.body.folder}}/{{cloudinarySignature.response.body.publicId}}"
}


### Remove profile image
DELETE {{baseUrl}}/api/auth/me/profile-image
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Upload profile image via API (multipart fallback)
# NOTE: VS Code REST Client doesn't have a great built-in file picker.
# If you want to test multipart quickly, use curl instead:
# curl -X POST {{baseUrl}}/api/auth/me/profile-image -H "Authorization: Bearer <token>" -F "file=@C:\\path\\to\\photo.jpg"


### List staff
GET {{baseUrl}}/api/staff
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Record sale
# Staff users: staff is auto-assigned.
# Admin/manager users: do NOT send staff; sale is attributed to the logged-in user.
# @name createSale
POST {{baseUrl}}/api/sales
Authorization: Bearer {{login.response.body.tokens.accessToken}}
Content-Type: application/json

{
  "product": "{{createProduct.response.body._id}}",
  "quantity": 2
}


### Checkout (multi-item, atomic)
# @name checkout
POST {{baseUrl}}/api/sales/checkout
Authorization: Bearer {{login.response.body.tokens.accessToken}}
Content-Type: application/json

{
  "items": [
    {
      "product": "{{createProduct.response.body._id}}",
      "quantity": 2
    }
  ],
  "client": {
    "expectedTotal": 1100
  }
}


### List sales
GET {{baseUrl}}/api/sales
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### List sales (filtered/paginated example)
GET {{baseUrl}}/api/sales?limit=20&page=1&sort=-createdAt
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### List transaction summaries
GET {{baseUrl}}/api/sales/transactions?limit=20&page=1
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Transaction details (from checkout)
GET {{baseUrl}}/api/sales/transactions/{{checkout.response.body.transaction.id}}
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Transaction receipt (from checkout)
GET {{baseUrl}}/api/sales/transactions/{{checkout.response.body.transaction.id}}/receipt
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Transaction details (from single sale)
GET {{baseUrl}}/api/sales/transactions/{{createSale.response.body.transactionId}}
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Transaction receipt (from single sale)
GET {{baseUrl}}/api/sales/transactions/{{createSale.response.body.transactionId}}/receipt
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Reports: total sales
GET {{baseUrl}}/api/reports/total-sales
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Reports: sales by staff
GET {{baseUrl}}/api/reports/sales-by-staff
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Reports: low stock
GET {{baseUrl}}/api/reports/low-stock
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Reports: profit (profit is computed only in some reports)
GET {{baseUrl}}/api/reports/profit
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Reports: profit by product
GET {{baseUrl}}/api/reports/profit-by-product
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Reports: profit by staff
GET {{baseUrl}}/api/reports/profit-by-staff
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Delete staff
DELETE {{baseUrl}}/api/staff/{{createStaff.response.body._id}}
Authorization: Bearer {{login.response.body.tokens.accessToken}}


### Delete product
DELETE {{baseUrl}}/api/products/{{createProduct.response.body._id}}
Authorization: Bearer {{login.response.body.tokens.accessToken}}